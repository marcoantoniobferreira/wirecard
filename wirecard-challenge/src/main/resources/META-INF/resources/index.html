<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Wirecard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/wingcss/0.1.8/wing.min.css"/>
    <!-- Load AngularJS -->
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <script type="text/javascript">
      var app = angular.module("CardManagement", []);
      //Controller Part
      app.controller("CardManagementController", function ($scope, $http) {
        //Initialize page with default data which is blank in this example
        $scope.payment = [];
        $scope.form = {
          name: "",
          cpf: ""
        };
        //Now load the data from server
        _refreshPageData();
        //HTTP POST methods for add fruits
        $scope.add = function () {
          var data = { "name": $scope.form.name, 
                       "cpf": $scope.form.cpf,
                       "email": $scope.form.email,
                       "amount": $scope.form.amount,
                       "cardNumber": $scope.form.cardNumber,
                       "expirationDate": $scope.form.expirationDate,
                       "cvv": $scope.form.cvv,
                       "paymentType": $scope.form.paymentType };
          $http({
            method: "POST",
            url: '/payment',
            data: angular.toJson(data),
            headers: {
              'Content-Type': 'application/json'
            }
          }).then(_success, _error);
        };
        /* Private Methods */
        //HTTP GET- get all fruits collection
        function _refreshPageData() {
          $http({
            method: 'GET',
            url: '/payment'
          }).then(function successCallback(response) {
            $scope.payment = response.data;
          }, function errorCallback(response) {
            console.log(response.statusText);
          });
        }
        function _success(response) {
          _refreshPageData();
          _clearForm();
        }
        function _error(response) {
          alert(response.data.message || response.statusText);
        }
        //Clear the form
        function _clearForm() {
          $scope.form.name = "";
          $scope.form.description = "";
        }
      });
    </script>
</head>
<body ng-app="CardManagement" ng-controller="CardManagementController">

<div class="container">
    <h1>Wirecard</h1>

    <h3>Informe os dados</h3>
    <form ng-submit="add()">
        <div class="row">
            <div class="col-4">Nome do Titular:<input type="text" placeholder="Nome do titular" ng-model="form.name" size="60" required/></div>
        </div>
        <div class="row">
            <div class="col-4">CPF: <input type="text" placeholder="CPF" ng-model="form.cpf" size="60" required></div>
        </div>
        <div class="row">
            <div class="col-4">E-mail:<input type="email" placeholder="E-mail" ng-model="form.email" required></div>
        </div>
        <div class="row">
          <div class="col-3">Valor:<input type="text" placeholder="Valor" ng-model="form.amount" size="20" required/></div>  
        </div>
        <div class="row">
            <div class="col-3">Número do cartão<input type="text" max="16" placeholder="número do cartão" ng-model="form.cardNumber" size="60" required/></div>
        </div>
        <div class="row">
          <div class="col-2">Data de expiração<input type="month" placeholder="data de expiração" ng-model="form.expirationDate" size="60" required/></div>  
        </div>
        <div class="row">
          <div class="col-2">CVV<input type="number" placeholder="CVV" ng-model="form.cvv" size="30" required/></div>  
        </div>
        <div class="row">
                <div class="col-3">
                    Forma de Pagamento:
                    <select placeholder="CVV" ng-model="form.paymentType"/>
                        <option value="creditCard">Cartão de Crédito</option>
                        <option value="boleto">Boleto</option>
                    </select>
                </div>  
            </div>        
        <input type="submit" value="Enviar"/>
    </form>
    <hr>
    <input type="submit" value="Consultar status"/>

    <h3>Fruit List</h3>
    <div class="row">
        <div class="col-4">Name</div>
        <div class="col-8">Description</div>
    </div>
    <div class="row" ng-repeat="card in cards">
        <div class="col-4">{{ fruit.name }}</div>
        <div class="col-8">{{ fruit.description }}</div>
    </div>
</div>

</body>
</html>